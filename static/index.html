<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SE Training - Coding Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        h1 {
            font-size: 24px;
        }
        
        .problem-list {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .problem-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .problem-item:hover {
            background-color: #f9f9f9;
        }
        
        .problem-item:last-child {
            border-bottom: none;
        }
        
        .problem-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .problem-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .difficulty {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .difficulty.easy {
            background-color: #d4edda;
            color: #155724;
        }
        
        .difficulty.medium {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .difficulty.hard {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .category {
            font-size: 14px;
            color: #666;
        }
        
        .problem-detail {
            display: none;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .problem-detail.active {
            display: block;
        }
        
        .back-button {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .back-button:hover {
            background-color: #5a6268;
        }
        
        .problem-description {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 20px;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        
        .editor-container {
            margin-bottom: 20px;
        }
        
        .editor-label {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }
        
        #code-editor {
            width: 100%;
            min-height: 400px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .submit-button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        
        .submit-button:hover {
            background-color: #218838;
        }
        
        .submit-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        .result-container {
            margin-top: 20px;
            padding: 20px;
            border-radius: 4px;
        }
        
        .result-container.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .result-container.failure {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .result-container.error {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .result-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .result-details {
            margin-top: 10px;
            font-size: 14px;
            white-space: pre-wrap;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .history-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .history-item {
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .history-item.success {
            border-left: 4px solid #28a745;
        }
        
        .history-item.failure {
            border-left: 4px solid #dc3545;
        }
        
        .history-item.error {
            border-left: 4px solid #ffc107;
        }
        
        .hint-solution-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        .hint-button, .solution-button {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        
        .hint-button:hover {
            background-color: #138496;
        }
        
        .solution-button {
            background-color: #28a745;
        }
        
        .solution-button:hover {
            background-color: #218838;
        }
        
        .hint-container, .solution-container {
            display: none;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        
        .hint-container.active, .solution-container.active {
            display: block;
        }
        
        .hint-container h3, .solution-container h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .hint-content, .solution-content {
            white-space: pre-wrap;
            line-height: 1.6;
            color: #333;
        }
        
        .code-block {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>SE Training - Coding Test</h1>
        </header>
        
        <div id="problem-list-view" class="problem-list">
            <h2>ÂïèÈ°å‰∏ÄË¶ß</h2>
            <div id="problem-items"></div>
        </div>
        
        <div id="problem-detail-view" class="problem-detail">
            <button class="back-button" onclick="showProblemList()">‚Üê ‰∏ÄË¶ß„Å´Êàª„Çã</button>
            <div id="problem-content"></div>
        </div>
    </div>
    
    <script>
        let currentProblem = null;
        
        // ÂïèÈ°å‰∏ÄË¶ß„ÇíÂèñÂæó
        async function loadProblems() {
            try {
                const response = await fetch('/api/problems/');
                const problems = await response.json();
                displayProblemList(problems);
            } catch (error) {
                console.error('ÂïèÈ°å‰∏ÄË¶ß„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
            }
        }
        
        // ÂïèÈ°å‰∏ÄË¶ß„ÇíË°®Á§∫
        function displayProblemList(problems) {
            const container = document.getElementById('problem-items');
            if (problems.length === 0) {
                container.innerHTML = '<p>ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
                return;
            }
            
            container.innerHTML = problems.map(problem => `
                <div class="problem-item" onclick="showProblemDetail('${problem.id}')">
                    <div class="problem-header">
                        <span class="problem-title">${problem.id}: ${problem.title}</span>
                        <span class="difficulty ${problem.difficulty}">${problem.difficulty.toUpperCase()}</span>
                    </div>
                    <div class="category">„Ç´„ÉÜ„Ç¥„É™: ${problem.category.join(', ')}</div>
                </div>
            `).join('');
        }
        
        // ÂïèÈ°åË©≥Á¥∞„ÇíË°®Á§∫
        async function showProblemDetail(problemId) {
            try {
                const response = await fetch(`/api/problems/${problemId}`);
                const problem = await response.json();
                currentProblem = problem;
                
                document.getElementById('problem-list-view').style.display = 'none';
                document.getElementById('problem-detail-view').classList.add('active');
                
                displayProblemDetail(problem);
                loadSubmissionHistory(problemId);
            } catch (error) {
                console.error('ÂïèÈ°å„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
                alert('ÂïèÈ°å„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }
        
        // ÂïèÈ°åË©≥Á¥∞„ÇíË°®Á§∫
        function displayProblemDetail(problem) {
            const content = document.getElementById('problem-content');
            const supportedLanguages = problem.supported_languages || ['python'];
            const defaultLanguage = supportedLanguages[0] || 'python';
            
            // Ë®ÄË™û„Å´Âøú„Åò„ÅüÂàùÊúü„Ç≥„Éº„Éâ„ÇíÁîüÊàê
            const getInitialCode = (lang) => {
                if (lang === 'typescript') {
                    // TypeScriptÂΩ¢Âºè„ÅÆÈñ¢Êï∞„Ç∑„Ç∞„Éç„ÉÅ„É£„Å´Â§âÊèõ
                    let sig = problem.function_signature;
                    sig = sig.replace(/def\s+(\w+)/, 'function $1');
                    sig = sig.replace(/->\s*(\w+):/, ': $1');
                    sig = sig.replace(/list\[int\]/g, 'number[]');
                    sig = sig.replace(/list\[str\]/g, 'string[]');
                    sig = sig.replace(/bool/g, 'boolean');
                    sig = sig.replace(/int/g, 'number');
                    return `export ${sig} {\n    \n}`;
                } else {
                    return `${problem.function_signature}\n    pass`;
                }
            };
            
            const languageOptions = supportedLanguages.map(lang => 
                `<option value="${lang}">${lang === 'python' ? 'Python' : 'TypeScript'}</option>`
            ).join('');
            
            content.innerHTML = `
                <h2>${problem.id}: ${problem.title}</h2>
                <div style="margin: 10px 0;">
                    <span class="difficulty ${problem.difficulty}">${problem.difficulty.toUpperCase()}</span>
                    <span style="margin-left: 10px; color: #666;">„Ç´„ÉÜ„Ç¥„É™: ${problem.category.join(', ')}</span>
                </div>
                <div class="problem-description">${problem.description}</div>
                <div class="hint-solution-buttons">
                    ${problem.hint ? '<button class="hint-button" onclick="toggleHint()">üí° „Éí„É≥„Éà„ÇíË°®Á§∫</button>' : ''}
                    ${problem.solution ? '<button class="solution-button" onclick="toggleSolution()">üìñ Á≠î„Åà„Å®Ëß£Ë™¨„ÇíË°®Á§∫</button>' : ''}
                </div>
                <div id="hint-container" class="hint-container">
                    ${problem.hint ? `<h3>üí° „Éí„É≥„Éà</h3><div class="hint-content">${formatMarkdown(problem.hint)}</div>` : ''}
                </div>
                <div id="solution-container" class="solution-container">
                    ${problem.solution ? `<h3>üìñ Á≠î„Åà„Å®Ëß£Ë™¨</h3><div class="solution-content">${formatMarkdown(problem.solution)}</div>` : ''}
                </div>
                <div class="editor-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <label class="editor-label">„Ç≥„Éº„Éâ:</label>
                        <select id="language-select" style="padding: 6px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" onchange="onLanguageChange()">
                            ${languageOptions}
                        </select>
                    </div>
                    <textarea id="code-editor">${getInitialCode(defaultLanguage)}</textarea>
                </div>
                <div class="button-group">
                    <button class="submit-button" onclick="submitCode()">ÂÆüË°å</button>
                </div>
                <div id="result-container"></div>
                <div class="history-section">
                    <h3>ÂÆüË°åÂ±•Ê≠¥</h3>
                    <div id="history-container"></div>
                </div>
            `;
        }
        
        // Ë®ÄË™ûÂ§âÊõ¥ÊôÇ„ÅÆÂá¶ÁêÜ
        function onLanguageChange() {
            if (!currentProblem) return;
            
            const select = document.getElementById('language-select');
            const editor = document.getElementById('code-editor');
            const selectedLang = select.value;
            
            // Ë®ÄË™û„Å´Âøú„Åò„ÅüÂàùÊúü„Ç≥„Éº„Éâ„ÇíÁîüÊàê
            if (selectedLang === 'typescript') {
                let sig = currentProblem.function_signature;
                sig = sig.replace(/def\s+(\w+)/, 'function $1');
                sig = sig.replace(/->\s*(\w+):/, ': $1');
                sig = sig.replace(/list\[int\]/g, 'number[]');
                sig = sig.replace(/list\[str\]/g, 'string[]');
                sig = sig.replace(/bool/g, 'boolean');
                sig = sig.replace(/int/g, 'number');
                editor.value = `export ${sig} {\n    \n}`;
            } else {
                editor.value = `${currentProblem.function_signature}\n    pass`;
            }
        }
        
        // „Ç≥„Éº„Éâ„ÇíÊèêÂá∫
        async function submitCode() {
            if (!currentProblem) return;
            
            const code = document.getElementById('code-editor').value;
            const submitButton = document.querySelector('.submit-button');
            const resultContainer = document.getElementById('result-container');
            
            submitButton.disabled = true;
            submitButton.innerHTML = '<span class="loading"></span>ÂÆüË°å‰∏≠...';
            resultContainer.innerHTML = '';
            
            try {
                const language = document.getElementById('language-select')?.value || 'python';
                const response = await fetch('/api/submissions/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        problem_id: currentProblem.id,
                        code: code,
                        language: language,
                    }),
                });
                
                const result = await response.json();
                displayResult(result);
                loadSubmissionHistory(currentProblem.id);
            } catch (error) {
                console.error('„Ç≥„Éº„Éâ„ÅÆÂÆüË°å„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
                displayResult({
                    result: 'error',
                    error_message: 'ÂÆüË°å„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message,
                });
            } finally {
                submitButton.disabled = false;
                submitButton.innerHTML = 'ÂÆüË°å';
            }
        }
        
        // ÁµêÊûú„ÇíË°®Á§∫
        function displayResult(submission) {
            const container = document.getElementById('result-container');
            const resultClass = submission.result;
            const resultText = {
                'success': '‚úì Ê≠£Ëß£',
                'failure': '‚úó ‰∏çÊ≠£Ëß£',
                'error': '‚ö† „Ç®„É©„Éº',
                'timeout': '‚è± „Çø„Ç§„É†„Ç¢„Ç¶„Éà',
            }[submission.result] || submission.result;
            
            let details = '';
            if (submission.execution_time_sec !== null && submission.execution_time_sec !== undefined) {
                details += `ÂÆüË°åÊôÇÈñì: ${submission.execution_time_sec.toFixed(3)}Áßí\n`;
            }
            if (submission.error_message) {
                details += `\n„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏:\n${submission.error_message}\n`;
            }
            if (submission.test_output) {
                details += `\n„ÉÜ„Çπ„ÉàÂá∫Âäõ:\n${submission.test_output}\n`;
            }
            
            container.innerHTML = `
                <div class="result-container ${resultClass}">
                    <div class="result-title">${resultText}</div>
                    ${details ? `<div class="result-details">${details}</div>` : ''}
                </div>
            `;
        }
        
        // ÂÆüË°åÂ±•Ê≠¥„ÇíË™≠„ÅøËæº„Åø
        async function loadSubmissionHistory(problemId) {
            try {
                const response = await fetch(`/api/submissions/history/${problemId}`);
                const history = await response.json();
                displaySubmissionHistory(history);
            } catch (error) {
                console.error('ÂÆüË°åÂ±•Ê≠¥„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
            }
        }
        
        // ÂÆüË°åÂ±•Ê≠¥„ÇíË°®Á§∫
        function displaySubmissionHistory(history) {
            const container = document.getElementById('history-container');
            if (history.length === 0) {
                container.innerHTML = '<p>ÂÆüË°åÂ±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
                return;
            }
            
            container.innerHTML = history.reverse().map(submission => {
                const date = new Date(submission.timestamp);
                const timeStr = date.toLocaleString('ja-JP');
                const resultText = {
                    'success': '‚úì Ê≠£Ëß£',
                    'failure': '‚úó ‰∏çÊ≠£Ëß£',
                    'error': '‚ö† „Ç®„É©„Éº',
                    'timeout': '‚è± „Çø„Ç§„É†„Ç¢„Ç¶„Éà',
                }[submission.result] || submission.result;
                
                let details = `ÂÆüË°åÊó•ÊôÇ: ${timeStr}`;
                if (submission.execution_time_sec !== null && submission.execution_time_sec !== undefined) {
                    details += ` | ÂÆüË°åÊôÇÈñì: ${submission.execution_time_sec.toFixed(3)}Áßí`;
                }
                
                return `
                    <div class="history-item ${submission.result}">
                        <div style="font-weight: bold; margin-bottom: 4px;">${resultText}</div>
                        <div style="color: #666; font-size: 12px;">${details}</div>
                    </div>
                `;
            }).join('');
        }
        
        // ÂïèÈ°å‰∏ÄË¶ß„Å´Êàª„Çã
        function showProblemList() {
            document.getElementById('problem-list-view').style.display = 'block';
            document.getElementById('problem-detail-view').classList.remove('active');
            currentProblem = null;
        }
        
        // „Éí„É≥„Éà„ÅÆË°®Á§∫/ÈùûË°®Á§∫
        function toggleHint() {
            const container = document.getElementById('hint-container');
            const button = document.querySelector('.hint-button');
            if (container) {
                container.classList.toggle('active');
                if (container.classList.contains('active')) {
                    button.textContent = 'üí° „Éí„É≥„Éà„ÇíÈùûË°®Á§∫';
                } else {
                    button.textContent = 'üí° „Éí„É≥„Éà„ÇíË°®Á§∫';
                }
            }
        }
        
        // Ëß£Ë™¨„ÅÆË°®Á§∫/ÈùûË°®Á§∫
        function toggleSolution() {
            const container = document.getElementById('solution-container');
            const button = document.querySelector('.solution-button');
            if (container) {
                container.classList.toggle('active');
                if (container.classList.contains('active')) {
                    button.textContent = 'üìñ Á≠î„Åà„Å®Ëß£Ë™¨„ÇíÈùûË°®Á§∫';
                } else {
                    button.textContent = 'üìñ Á≠î„Åà„Å®Ëß£Ë™¨„ÇíË°®Á§∫';
                }
            }
        }
        
        // Markdown„ÇíÁ∞°ÊòìÁöÑ„Å´HTML„Å´Â§âÊèõ
        function formatMarkdown(text) {
            if (!text) return '';
            
            // HTML„Ç®„Çπ„Ç±„Éº„Éó
            text = escapeHtml(text);
            
            // „Ç≥„Éº„Éâ„Éñ„É≠„ÉÉ„ÇØ„ÇíÂ§âÊèõ
            text = text.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                return `<div class="code-block">${code.trim()}</div>`;
            });
            
            // „Ç§„É≥„É©„Ç§„É≥„Ç≥„Éº„Éâ„ÇíÂ§âÊèõ
            text = text.replace(/`([^`]+)`/g, '<code style="background-color: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-family: monospace;">$1</code>');
            
            // Ë¶ãÂá∫„Åó„ÇíÂ§âÊèõ
            text = text.replace(/^### (.*$)/gim, '<h4>$1</h4>');
            text = text.replace(/^## (.*$)/gim, '<h3>$1</h3>');
            text = text.replace(/^# (.*$)/gim, '<h2>$1</h2>');
            
            // „É™„Çπ„Éà„ÇíÂ§âÊèõÔºàÁ∞°ÊòìÁâàÔºâ
            const lines = text.split('<br>');
            let result = [];
            let inList = false;
            
            for (let line of lines) {
                if (/^[\*\-] /.test(line)) {
                    if (!inList) {
                        result.push('<ul>');
                        inList = true;
                    }
                    result.push('<li>' + line.replace(/^[\*\-] /, '') + '</li>');
                } else {
                    if (inList) {
                        result.push('</ul>');
                        inList = false;
                    }
                    result.push(line);
                }
            }
            if (inList) {
                result.push('</ul>');
            }
            text = result.join('<br>');
            
            // Â§™Â≠ó„ÇíÂ§âÊèõ
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            return text;
        }
        
        // HTML„Ç®„Çπ„Ç±„Éº„Éó
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ÂàùÊúüÂåñ
        loadProblems();
    </script>
</body>
</html>

