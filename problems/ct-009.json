{
  "id": "ct-009",
  "title": "APIログからレイテンシ異常区間を検出せよ",
  "difficulty": "hard",
  "category": ["sliding-window", "array", "interval"],
  "time_limit_sec": 2.0,
  "memory_limit_mb": 512,
  "description": "# APIログからレイテンシ異常区間を検出せよ\n\n## 問題概要\n\nAPIのレスポンスタイムログが与えられます。一定時間ウィンドウ内の平均レイテンシが閾値を超えた区間を検出してください。\n\nスライディングウィンドウ方式で、各時点でのウィンドウ内の平均レイテンシを計算し、閾値を超えた区間を特定します。重複・隣接する区間はマージしてください。\n\n## 入力仕様\n\n- `logs`: ログのリスト。各ログは以下のプロパティを持つ\n  - `timestamp`: タイムスタンプ（秒、整数）\n  - `latencyMs`: レイテンシ（ミリ秒、非負整数）\n- `windowSec`: スライディングウィンドウのサイズ（秒、正の整数）\n- `latencyThreshold`: 平均レイテンシの閾値（ミリ秒、非負数）\n\n## 出力仕様\n\n- `list[tuple[int, int]]`: 異常区間のリスト。各要素は `(start_time, end_time)` のタプルで、開始時刻と終了時刻を表す（両端含む）。区間は開始時刻の昇順でソートされ、重複・隣接区間はマージされている\n\n## 制約条件\n\n- `0 <= len(logs) <= 2 * 10^5`\n- `1 <= windowSec <= 10^6`\n- `0 <= latencyThreshold <= 10^6`\n- ログはタイムスタンプの昇順でソートされている\n- `0 <= timestamp <= 10^9`\n- `0 <= latencyMs <= 10^6`\n\n## サンプル入力・出力\n\n### サンプル1（ログなし）\n\n入力:\n```typescript\nlogs = []\nwindowSec = 60\nlatencyThreshold = 100\n```\n\n出力:\n```typescript\n[]\n```\n\n### サンプル2（正常なレイテンシ）\n\n入力:\n```typescript\nlogs = [\n  { timestamp: 0, latencyMs: 50 },\n  { timestamp: 10, latencyMs: 60 },\n  { timestamp: 20, latencyMs: 70 }\n]\nwindowSec = 60\nlatencyThreshold = 100\n```\n\n出力:\n```typescript\n[]  # 平均レイテンシが閾値を超えていない\n```\n\n### サンプル3（単一異常区間）\n\n入力:\n```typescript\nlogs = [\n  { timestamp: 0, latencyMs: 50 },\n  { timestamp: 10, latencyMs: 150 },\n  { timestamp: 20, latencyMs: 200 },\n  { timestamp: 30, latencyMs: 50 }\n]\nwindowSec = 60\nlatencyThreshold = 100\n```\n\n出力:\n```typescript\n[(0, 60)]  # ウィンドウ[0,60]で平均レイテンシが閾値を超える\n```\n\n### サンプル4（複数区間）\n\n入力:\n```typescript\nlogs = [\n  { timestamp: 0, latencyMs: 200 },\n  { timestamp: 10, latencyMs: 200 },\n  { timestamp: 100, latencyMs: 150 },\n  { timestamp: 110, latencyMs: 150 }\n]\nwindowSec = 50\nlatencyThreshold = 100\n```\n\n出力:\n```typescript\n[(0, 50), (100, 150)]  # 2つの独立した異常区間\n```",
  "function_signature": "def solve(logs: list[dict], windowSec: int, latencyThreshold: float) -> list[tuple[int, int]]:",
  "test_code": "def test_sample1():\n    assert solve([], 60, 100) == []\n\ndef test_sample2():\n    logs = [\n        {\"timestamp\": 0, \"latencyMs\": 50},\n        {\"timestamp\": 10, \"latencyMs\": 60},\n        {\"timestamp\": 20, \"latencyMs\": 70}\n    ]\n    assert solve(logs, 60, 100) == []\n\ndef test_sample3():\n    logs = [\n        {\"timestamp\": 0, \"latencyMs\": 50},\n        {\"timestamp\": 10, \"latencyMs\": 150},\n        {\"timestamp\": 20, \"latencyMs\": 200},\n        {\"timestamp\": 30, \"latencyMs\": 50}\n    ]\n    result = solve(logs, 60, 100)\n    assert len(result) == 1\n    assert result[0][0] == 0\n    assert result[0][1] >= 30\n\ndef test_sample4():\n    logs = [\n        {\"timestamp\": 0, \"latencyMs\": 200},\n        {\"timestamp\": 10, \"latencyMs\": 200},\n        {\"timestamp\": 100, \"latencyMs\": 150},\n        {\"timestamp\": 110, \"latencyMs\": 150}\n    ]\n    result = solve(logs, 50, 100)\n    assert len(result) >= 1\n    # 区間はソートされている\n    for i in range(len(result) - 1):\n        assert result[i][0] < result[i + 1][0]\n\ndef test_no_anomaly():\n    logs = [\n        {\"timestamp\": 0, \"latencyMs\": 50},\n        {\"timestamp\": 10, \"latencyMs\": 60}\n    ]\n    assert solve(logs, 60, 100) == []\n\ndef test_all_anomaly():\n    logs = [\n        {\"timestamp\": 0, \"latencyMs\": 200},\n        {\"timestamp\": 10, \"latencyMs\": 300}\n    ]\n    result = solve(logs, 60, 100)\n    assert len(result) == 1\n\ndef test_threshold_exact():\n    # 平均レイテンシがちょうど閾値の場合は超えていないとみなす\n    logs = [\n        {\"timestamp\": 0, \"latencyMs\": 100},\n        {\"timestamp\": 10, \"latencyMs\": 100}\n    ]\n    result = solve(logs, 60, 100)\n    # 実装により異なる可能性があるが、閾値を超えていない場合は空\n    assert isinstance(result, list)\n\ndef test_adjacent_intervals():\n    # 隣接する区間がマージされることを確認\n    logs = [\n        {\"timestamp\": 0, \"latencyMs\": 200},\n        {\"timestamp\": 50, \"latencyMs\": 200},\n        {\"timestamp\": 100, \"latencyMs\": 200}\n    ]\n    result = solve(logs, 50, 100)\n    assert isinstance(result, list)\n    if len(result) > 1:\n        for i in range(len(result) - 1):\n            assert result[i][1] < result[i + 1][0]  # 隣接していない",
  "supported_languages": ["python", "typescript"]
}




