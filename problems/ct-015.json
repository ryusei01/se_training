{
  "id": "ct-015",
  "title": "設定オブジェクトのバリデーションと正規化",
  "difficulty": "medium",
  "category": ["validation", "normalization"],
  "time_limit_sec": 1.0,
  "memory_limit_mb": 256,
  "description": "# 設定オブジェクトのバリデーションと正規化\n\n## 問題概要\n\nE2Eテスト設定を表すオブジェクトを検証・正規化してください。\n\n各フィールドにはデフォルト値があり、不正な値の場合はエラーを投げてください。\n\n## 入力仕様\n\n- `config`: 設定オブジェクト。以下のプロパティを持つ（すべてオプション）\n  - `retry`: 再試行回数（整数、オプション）\n  - `timeoutMs`: タイムアウト時間（ミリ秒、整数、オプション）\n  - `browsers`: ブラウザのリスト（文字列のリスト、オプション）\n\n## 出力仕様\n\n- `dict`: 正規化された設定オブジェクト。以下のプロパティを持つ\n  - `retry`: 再試行回数（整数、0以上）\n  - `timeoutMs`: タイムアウト時間（ミリ秒、整数、1000以上）\n  - `browsers`: ブラウザのリスト（文字列のリスト、重複なし、空でない）\n\n## バリデーションルール\n\n- `retry`:\n  - 未指定の場合: `0`\n  - 負数の場合: エラー（`ValueError` を投げる）\n  - それ以外: そのまま使用\n\n- `timeoutMs`:\n  - 未指定の場合: `5000`\n  - 1000未満の場合: エラー（`ValueError` を投げる）\n  - それ以外: そのまま使用\n\n- `browsers`:\n  - 未指定の場合: `[\"chrome\"]`\n  - 重複がある場合: 重複を除去\n  - 空配列の場合: エラー（`ValueError` を投げる）\n  - それ以外: 重複を除去して使用\n\n## 制約条件\n\n- `retry` が指定される場合、`-10^9 <= retry <= 10^9`\n- `timeoutMs` が指定される場合、`1 <= timeoutMs <= 10^9`\n- `browsers` が指定される場合、`1 <= len(browsers) <= 100`\n- 各ブラウザ名の長さは1以上100以下\n\n## サンプル入力・出力\n\n### サンプル1（すべて未指定）\n\n入力:\n```typescript\nconfig = {}\n```\n\n出力:\n```typescript\n{\n  retry: 0,\n  timeoutMs: 5000,\n  browsers: [\"chrome\"]\n}\n```\n\n### サンプル2（すべて指定）\n\n入力:\n```typescript\nconfig = {\n  retry: 3,\n  timeoutMs: 10000,\n  browsers: [\"chrome\", \"firefox\"]\n}\n```\n\n出力:\n```typescript\n{\n  retry: 3,\n  timeoutMs: 10000,\n  browsers: [\"chrome\", \"firefox\"]\n}\n```\n\n### サンプル3（重複除去）\n\n入力:\n```typescript\nconfig = {\n  browsers: [\"chrome\", \"firefox\", \"chrome\"]\n}\n```\n\n出力:\n```typescript\n{\n  retry: 0,\n  timeoutMs: 5000,\n  browsers: [\"chrome\", \"firefox\"]\n}\n```\n\n### サンプル4（エラーケース：retryが負数）\n\n入力:\n```typescript\nconfig = {\n  retry: -1\n}\n```\n\n出力:\n```typescript\nValueError  # \"retry must be non-negative\"\n```\n\n### サンプル5（エラーケース：timeoutMsが1000未満）\n\n入力:\n```typescript\nconfig = {\n  timeoutMs: 500\n}\n```\n\n出力:\n```typescript\nValueError  # \"timeoutMs must be at least 1000\"\n```\n\n### サンプル6（エラーケース：browsersが空配列）\n\n入力:\n```typescript\nconfig = {\n  browsers: []\n}\n```\n\n出力:\n```typescript\nValueError  # \"browsers must not be empty\"\n```",
  "function_signature": "def solve(config: dict) -> dict:",
  "test_code": "def test_sample1():\n    result = solve({})\n    assert result[\"retry\"] == 0\n    assert result[\"timeoutMs\"] == 5000\n    assert result[\"browsers\"] == [\"chrome\"]\n\ndef test_sample2():\n    config = {\"retry\": 3, \"timeoutMs\": 10000, \"browsers\": [\"chrome\", \"firefox\"]}\n    result = solve(config)\n    assert result[\"retry\"] == 3\n    assert result[\"timeoutMs\"] == 10000\n    assert result[\"browsers\"] == [\"chrome\", \"firefox\"]\n\ndef test_sample3():\n    config = {\"browsers\": [\"chrome\", \"firefox\", \"chrome\"]}\n    result = solve(config)\n    assert result[\"browsers\"] == [\"chrome\", \"firefox\"] or result[\"browsers\"] == [\"firefox\", \"chrome\"]\n    assert len(result[\"browsers\"]) == 2\n\ndef test_sample4():\n    config = {\"retry\": -1}\n    try:\n        solve(config)\n        assert False, \"Should raise ValueError\"\n    except ValueError:\n        pass\n\ndef test_sample5():\n    config = {\"timeoutMs\": 500}\n    try:\n        solve(config)\n        assert False, \"Should raise ValueError\"\n    except ValueError:\n        pass\n\ndef test_sample6():\n    config = {\"browsers\": []}\n    try:\n        solve(config)\n        assert False, \"Should raise ValueError\"\n    except ValueError:\n        pass\n\ndef test_retry_zero():\n    config = {\"retry\": 0}\n    result = solve(config)\n    assert result[\"retry\"] == 0\n\ndef test_timeoutMs_minimum():\n    config = {\"timeoutMs\": 1000}\n    result = solve(config)\n    assert result[\"timeoutMs\"] == 1000\n\ndef test_single_browser():\n    config = {\"browsers\": [\"safari\"]}\n    result = solve(config)\n    assert result[\"browsers\"] == [\"safari\"]\n\ndef test_partial_config():\n    config = {\"retry\": 2}\n    result = solve(config)\n    assert result[\"retry\"] == 2\n    assert result[\"timeoutMs\"] == 5000\n    assert result[\"browsers\"] == [\"chrome\"]",
  "supported_languages": ["python", "typescript"],
  "hint": "## ヒント\n\nこの問題は**バリデーションとデフォルト値の設定**がポイントです。\n\n### 重要なポイント\n\n1. **デフォルト値**: 未指定のフィールドにはデフォルト値を設定\n2. **バリデーション**: 各フィールドの値が有効範囲内かチェック\n3. **エラーハンドリング**: 不正な値の場合は `ValueError` を投げる\n4. **重複除去**: `browsers` 配列の重複を除去（順序は保持）\n\n### 処理の流れ\n\n1. `retry` の処理\n   - 未指定 → 0\n   - 負数 → ValueError\n   - それ以外 → そのまま使用\n2. `timeoutMs` の処理\n   - 未指定 → 5000\n   - 1000未満 → ValueError\n   - それ以外 → そのまま使用\n3. `browsers` の処理\n   - 未指定 → [\"chrome\"]\n   - 空配列 → ValueError\n   - 重複除去（順序保持）\n\n### 注意点\n\n- Pythonでは `dict.get()` や `in` 演算子でキーの存在を確認\n- 重複除去は `list(dict.fromkeys(browsers))` で順序を保持しながら除去可能",
  "solution": "## 答えと解説\n\n### 解法\n\n```python\ndef solve(config: dict) -> dict:\n    result = {}\n    \n    # retry の処理\n    if \"retry\" in config:\n        retry = config[\"retry\"]\n        if retry < 0:\n            raise ValueError(\"retry must be non-negative\")\n        result[\"retry\"] = retry\n    else:\n        result[\"retry\"] = 0\n    \n    # timeoutMs の処理\n    if \"timeoutMs\" in config:\n        timeout_ms = config[\"timeoutMs\"]\n        if timeout_ms < 1000:\n            raise ValueError(\"timeoutMs must be at least 1000\")\n        result[\"timeoutMs\"] = timeout_ms\n    else:\n        result[\"timeoutMs\"] = 5000\n    \n    # browsers の処理\n    if \"browsers\" in config:\n        browsers = config[\"browsers\"]\n        if len(browsers) == 0:\n            raise ValueError(\"browsers must not be empty\")\n        # 重複除去（順序保持）\n        result[\"browsers\"] = list(dict.fromkeys(browsers))\n    else:\n        result[\"browsers\"] = [\"chrome\"]\n    \n    return result\n```\n\n### 解説\n\n1. **デフォルト値の設定**: `in` 演算子でキーの存在を確認し、存在しない場合はデフォルト値を設定\n2. **バリデーション**: 各フィールドの値が有効範囲内かチェックし、不正な場合は `ValueError` を投げる\n3. **重複除去**: `dict.fromkeys()` を使用して順序を保持しながら重複を除去\n\n### ポイント\n\n- **Defensive Programming**: 入力値の検証を徹底する\n- **エラーメッセージ**: 明確なエラーメッセージを提供する\n- **型安全性**: TypeScriptでは型チェックも重要\n\n### 時間計算量\n\n- **時間計算量**: O(m) ここで m は browsers 配列の長さ（重複除去のため）\n- **空間計算量**: O(m)"
}
