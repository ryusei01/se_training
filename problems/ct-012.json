{
  "id": "ct-012",
  "title": "ストリームデータのトップK集計",
  "difficulty": "hard",
  "category": ["heap", "data-structure"],
  "time_limit_sec": 2.0,
  "memory_limit_mb": 512,
  "description": "# ストリームデータのトップK集計\n\n## 問題概要\n\n数値ストリームが流れてきます。任意時点で上位K個の値の合計を即座に返せるようにしてください。\n\nデータ構造を設計し、以下の操作を実装してください：\n1. `add(value)`: ストリームに値を追加\n2. `query()`: 現在のストリーム内の上位K個の値の合計を返す\n\nKは固定値（コンストラクタで指定）とします。\n\n## 入力仕様\n\n- `k`: 上位K個のK（正の整数）\n- `operations`: 操作のリスト。各操作は以下のいずれか\n  - `[\"add\", value]`: 値を追加（`value`は整数）\n  - `[\"query\"]`: 上位K個の合計を取得\n\n## 出力仕様\n\n- `list[int]`: 各 `query` 操作に対する結果のリスト（順序はクエリの実行順）\n\n## 制約条件\n\n- `1 <= k <= 10^5`\n- `1 <= len(operations) <= 2 * 10^5`\n- `-10^9 <= value <= 10^9`\n- `add` と `query` は任意の順序で呼ばれる\n- ストリーム内の値がK個未満の場合、すべての値の合計を返す\n\n## サンプル入力・出力\n\n### サンプル1\n\n入力:\n```typescript\nk = 2\noperations = [\n  [\"add\", 5],\n  [\"add\", 3],\n  [\"query\"],\n  [\"add\", 7],\n  [\"query\"]\n]\n```\n\n出力:\n```typescript\n[8, 12]  # 1回目: [5,3]の合計=8, 2回目: [7,5]の合計=12\n```\n\n### サンプル2\n\n入力:\n```typescript\nk = 3\noperations = [\n  [\"add\", 1],\n  [\"add\", 2],\n  [\"add\", 3],\n  [\"query\"],\n  [\"add\", 10],\n  [\"query\"]\n]\n```\n\n出力:\n```typescript\n[6, 15]  # 1回目: [1,2,3]の合計=6, 2回目: [10,3,2]の合計=15\n```\n\n### サンプル3（負数混在）\n\n入力:\n```typescript\nk = 2\noperations = [\n  [\"add\", -5],\n  [\"add\", 10],\n  [\"add\", -3],\n  [\"query\"]\n]\n```\n\n出力:\n```typescript\n[7]  # [10, -3]の合計=7（負数は上位に含まれない）\n```\n\n### サンプル4（K個未満）\n\n入力:\n```typescript\nk = 5\noperations = [\n  [\"add\", 1],\n  [\"add\", 2],\n  [\"query\"]\n]\n```\n\n出力:\n```typescript\n[3]  # 値が2個しかないので、すべての合計=3\n```",
  "function_signature": "def solve(k: int, operations: list) -> list[int]:",
  "test_code": "def test_sample1():\n    ops = [\n        [\"add\", 5],\n        [\"add\", 3],\n        [\"query\"],\n        [\"add\", 7],\n        [\"query\"]\n    ]\n    result = solve(2, ops)\n    assert result == [8, 12]\n\ndef test_sample2():\n    ops = [\n        [\"add\", 1],\n        [\"add\", 2],\n        [\"add\", 3],\n        [\"query\"],\n        [\"add\", 10],\n        [\"query\"]\n    ]\n    result = solve(3, ops)\n    assert result == [6, 15]\n\ndef test_sample3():\n    ops = [\n        [\"add\", -5],\n        [\"add\", 10],\n        [\"add\", -3],\n        [\"query\"]\n    ]\n    result = solve(2, ops)\n    assert result[0] == 7  # [10, -3]の合計\n\ndef test_sample4():\n    ops = [\n        [\"add\", 1],\n        [\"add\", 2],\n        [\"query\"]\n    ]\n    result = solve(5, ops)\n    assert result == [3]\n\ndef test_single_element():\n    ops = [[\"add\", 5], [\"query\"]]\n    result = solve(1, ops)\n    assert result == [5]\n\ndef test_all_negative():\n    ops = [\n        [\"add\", -1],\n        [\"add\", -2],\n        [\"add\", -3],\n        [\"query\"]\n    ]\n    result = solve(2, ops)\n    # 上位2個は[-1, -2]、合計=-3\n    assert result[0] == -3\n\ndef test_query_before_add():\n    ops = [[\"query\"]]\n    result = solve(1, ops)\n    # 値が0個の場合、合計は0\n    assert result == [0]\n\ndef test_large_k():\n    ops = [\n        [\"add\", 1],\n        [\"add\", 2],\n        [\"query\"]\n    ]\n    result = solve(100, ops)\n    assert result == [3]\n\ndef test_mixed_operations():\n    ops = [\n        [\"add\", 1],\n        [\"query\"],\n        [\"add\", 5],\n        [\"add\", 3],\n        [\"query\"],\n        [\"add\", 7],\n        [\"query\"]\n    ]\n    result = solve(2, ops)\n    assert len(result) == 3\n    assert result[0] == 1  # [1]\n    assert result[1] == 8  # [5,3]\n    assert result[2] == 12  # [7,5]",
  "supported_languages": ["python", "typescript"]
}
